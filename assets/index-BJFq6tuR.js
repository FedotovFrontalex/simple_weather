(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const p={getLocation:async()=>fetch("https://get.geojs.io/v1/ip/geo.json").then(async t=>await t.json()).then(t=>({lat:t.latitude,long:t.longitude}))},u=(t,e)=>{if(!Array.isArray(t))throw new Error("isExistingValue required only array data");return!!t.find(n=>n===e)},s="history",d={get:function(){const t=localStorage.getItem(s);return t?JSON.parse(t):[]},update:function(t){const e=this.get();if(u(e,t)){const n=e.findIndex(i=>i===t);this.set([t,...e.slice(0,n),...e.slice(n+1)]);return}e.length===10?this.set([t,...e.slice(0,9)]):this.set([t,...e])},set:function(t){typeof t!="string"?localStorage.setItem(s,JSON.stringify(t)):localStorage.setItem(s,t)}},f=t=>fetch(`https://api.openweathermap.org/data/2.5/weather?q=${t}&units=metric&lang=ru&appid=0f86b04b7f68189ff2685c07a953cefa`).then(e=>e.json()).then(e=>({name:e.name,temp:e.main.temp,tempLike:e.main.feels_like,description:e.weather[0].description,icon:e.weather[0].icon,coordinates:e.coord})).catch(e=>{alert("Не удалось найти город")}),h=({lat:t,long:e})=>fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${t}&lon=${e}&units=metric&lang=ru&appid=0f86b04b7f68189ff2685c07a953cefa`).then(n=>n.json()).then(n=>({name:n.name,temp:n.main.temp,tempLike:n.main.feels_like,description:n.weather[0].description,icon:n.weather[0].icon,coordinates:n.coord})).catch(n=>{alert("Не удалось найти город")}),l={mapContainer:null,updateMap:function(t){document.getElementById("map"),this.mapContainer&&this.mapContainer.remove(),DG&&DG.then(e=>{this.mapContainer=DG.map("map",{center:[t.lat,t.long],zoom:13,dragging:!1,touchZoom:!1,scrollWheelZoom:!1,doubleClickZoom:!1,boxZoom:!1,geoclicker:!1,zoomControl:!1,fullscreenControl:!1})})}},g=t=>{const e=document.createElement("li"),n=document.createElement("button");return n.innerHTML=t,n.addEventListener("click",()=>{m.inputCityHandler(t)}),e.appendChild(n),e},a={renderWeather:function(t){console.log("WEATHER: ",t);const e=document.getElementById("weatherInfo");e.innerHTML="";const n=document.createElement("img"),i=document.createElement("p"),o=document.createElement("p"),r=document.createElement("p");n.setAttribute("src",`https://openweathermap.org/img/wn/${t.icon}@2x.png`),n.classList.add("weatherIcon"),i.innerHTML=t.description,o.innerHTML=`Температура воздуха ${t.temp}`,r.innerHTML=`Ощущается, как ${t.tempLike}`,e.appendChild(n),e.appendChild(i),e.appendChild(o),e.appendChild(r)},renderHistory:()=>{const t=document.getElementById("history"),e=document.createElement("ul"),n=d.get();for(let i=0;i<n.length;i++)e.appendChild(g(n[i]));t.innerHTML="",t.appendChild(e)}},y={initForm:t=>{const e=document.getElementById("weatherForm");e.addEventListener("submit",n=>{n.preventDefault();const i=new FormData(e);t(i.get("city")),e.reset()})}},m={initialize:async function(t){y.initForm(this.inputCityHandler),a.renderHistory(),l.updateMap(t);const e=await h(t);a.renderWeather(e)},inputCityHandler:async function(t){const e=await f(t);e.coordinates&&l.updateMap({lat:e.coordinates.lat,long:e.coordinates.lon}),a.renderWeather(e),d.update(e.name),a.renderHistory()}},E=async()=>{const t=await p.getLocation();m.initialize(t)};E();
